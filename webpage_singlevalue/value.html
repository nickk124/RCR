<!DOCTYPE html>
<html>


	<meta name="viewport" content="width=device-width, initial-scale=1">
	<head>
        {{response.files.append(URL('static','css/rcr.css'))}}

        {{include 'web2py_ajax.html'}}
		<link href='https://fonts.googleapis.com/css?family=Josefin+Sans:300' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="https://cdn.pydata.org/bokeh/release/bokeh-1.0.4.min.css" type="text/css" />
    <link rel="stylesheet" href="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.0.4.min.css" type="text/css" />

    <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-1.0.4.min.js"></script>
    <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.0.4.min.js"></script>
    <script type="text/javascript">
        Bokeh.set_log_level("info");
    </script>

		<title> Robust Chauvenet Rejection </title>
	</head>


	<body>

<!--////////////////////////////////////////////////////////////////////////////-->
<!-- NAVIGATION BAR -->
<!--////////////////////////////////////////////////////////////////////////////-->
		<div id="wrap">
		<ul class="navbar">
            <li style="margin-left:50px;"><a href="{{=URL(request.application, 'calculator', 'index')}}">Home</a> </li>
            <li><a style="background-color:#5b8dd9;">Single-Value Calculator</a></li>
            <li><a href="{{=URL(request.application, 'calculator', 'functional')}}">Functional Calculator</a></li>
            <li><a href="{{=URL(request.application, 'calculator', 'downloads')}}">Downloads</a> </li>
            <li><a href="{{=URL(request.application, 'calculator', 'contact')}}">Contact Us</a> </li>
		</ul>
		</div>

<!--////////////////////////////////////////////////////////////////////////////-->
<!-- REJECTION METHOD SECTION -->
<!--////////////////////////////////////////////////////////////////////////////-->


		<div id="RMInput">
			<h1 style="font-size:3.5em;"> Single-Value RCR Calculator </h1>
            <br>

	    <h1 style="font-size:2.5em;"> Input Data</h1>
            <div id="StepOne">
                <div  id="ButtonSection">
                    <h2> Select Data Type: </h2>
                    <button id='Unweighted' class="Button DataType"> Equal Weights (Default) </button>
                    <button id='Weighted' class="Button DataType"> Unequal Weights </button>
										<button id='ErrorBars' class="Button DataType"> Error Bars </button>
                    <br>
                    <br>

                    <i style="padding-top:10px">Format: One value per line.  Weights, if unequal, should be included on the same line, separated by white space.</i>
										<br>
										<br>
										<i style="padding-top:10px">Alternatively, (symmetric) error bars may be entered instead of weights. These will be converted to weights using weight = 1/error<sup>2</sup>. However, if the scatter of the data is too large to be accounted for by the error bars alone, extrinsic scatter dominates and "Equal Weights" should be selected instead (&sect8.2.1, Maples et al. 2018).</i>
                </div>
                <div id="RejectionMethod" style="padding-top:25px;  position:relative; float:right">
                    <textarea class="dataTable" id="inputTextAreaData"></textarea>
                </div>
            </div>
		<br>
<br>
<br>

			<h1 style="font-size:2.5em;">Plot Data and Select Basis</h1>
			<div id="StepOne">
					<div id="Plot" style="float:left; padding-bottom:25px">
						<div class="bk-root" id="433bc3e3-c3d3-401b-b16a-7eb009a7e174" data-root-id="1065"></div>

						<script type="application/json" id="1187">
		          {"efb47904-c92a-4d29-b494-7ca5ba6c5b18":{"roots":{"references":[{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_property_callbacks":{"change:clicks":[{"id":"1043","type":"CustomJS"}]},"label":"Plot Histogram"},"id":"1050","type":"Button"},{"attributes":{"data_source":{"id":"1001","type":"ColumnDataSource"},"glyph":{"id":"1039","type":"Quad"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1040","type":"Quad"},"selection_glyph":null,"view":{"id":"1042","type":"CDSView"}},"id":"1041","type":"GlyphRenderer"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1023","type":"PanTool"},{"id":"1024","type":"WheelZoomTool"},{"id":"1025","type":"BoxZoomTool"},{"id":"1026","type":"SaveTool"},{"id":"1027","type":"ResetTool"},{"id":"1028","type":"HelpTool"}]},"id":"1029","type":"Toolbar"},{"attributes":{"bottom":{"value":0},"fill_color":{"value":"cornflowerblue"},"left":{"field":"left"},"right":{"field":"right"},"top":{"field":"arr_hist"}},"id":"1039","type":"Quad"},{"attributes":{},"id":"1070","type":"BasicTickFormatter"},{"attributes":{},"id":"1023","type":"PanTool"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_property_callbacks":{"change:clicks":[{"id":"1045","type":"CustomJS"}]},"label":"Add Bins"},"id":"1051","type":"Button"},{"attributes":{},"id":"1011","type":"LinearScale"},{"attributes":{},"id":"1024","type":"WheelZoomTool"},{"attributes":{},"id":"1071","type":"UnionRenderers"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_property_callbacks":{"change:clicks":[{"id":"1046","type":"CustomJS"}]},"label":"Subtract Bins"},"id":"1052","type":"Button"},{"attributes":{"overlay":{"id":"1031","type":"BoxAnnotation"}},"id":"1025","type":"BoxZoomTool"},{"attributes":{},"id":"1072","type":"Selection"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_property_callbacks":{"change:clicks":[{"id":"1047","type":"CustomJS"}]},"label":"Linear"},"id":"1053","type":"Button"},{"attributes":{"axis_label":"y (data)","formatter":{"id":"1070","type":"BasicTickFormatter"},"plot":{"id":"1003","subtype":"Figure","type":"Plot"},"ticker":{"id":"1014","type":"BasicTicker"}},"id":"1013","type":"LinearAxis"},{"attributes":{},"id":"1026","type":"SaveTool"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_property_callbacks":{"change:clicks":[{"id":"1048","type":"CustomJS"}]},"label":"Logarithmic"},"id":"1054","type":"Button"},{"attributes":{},"id":"1014","type":"BasicTicker"},{"attributes":{},"id":"1027","type":"ResetTool"},{"attributes":{"below":[{"id":"1013","type":"LinearAxis"}],"left":[{"id":"1018","type":"LinearAxis"}],"plot_height":400,"renderers":[{"id":"1013","type":"LinearAxis"},{"id":"1017","type":"Grid"},{"id":"1018","type":"LinearAxis"},{"id":"1022","type":"Grid"},{"id":"1031","type":"BoxAnnotation"},{"id":"1041","type":"GlyphRenderer"}],"title":{"id":"1002","type":"Title"},"toolbar":{"id":"1029","type":"Toolbar"},"x_range":{"id":"1005","type":"DataRange1d"},"x_scale":{"id":"1009","type":"LinearScale"},"y_range":{"id":"1007","type":"DataRange1d"},"y_scale":{"id":"1011","type":"LinearScale"}},"id":"1003","subtype":"Figure","type":"Plot"},{"attributes":{"bottom":{"value":0},"fill_alpha":{"value":0.1},"fill_color":{"value":"#1f77b4"},"left":{"field":"left"},"line_alpha":{"value":0.1},"line_color":{"value":"#1f77b4"},"right":{"field":"right"},"top":{"field":"arr_hist"}},"id":"1040","type":"Quad"},{"attributes":{"button_type":"primary","callback":null,"icon":null,"js_property_callbacks":{"change:clicks":[{"id":"1049","type":"CustomJS"}]},"label":"Exponential"},"id":"1055","type":"Button"},{"attributes":{"plot":{"id":"1003","subtype":"Figure","type":"Plot"},"ticker":{"id":"1014","type":"BasicTicker"}},"id":"1017","type":"Grid"},{"attributes":{},"id":"1028","type":"HelpTool"},{"attributes":{"children":[{"id":"1056","type":"WidgetBox"},{"id":"1057","type":"WidgetBox"},{"id":"1058","type":"WidgetBox"}],"sizing_mode":"scale_width"},"id":"1059","type":"Row"},{"attributes":{"plot":null,"text":"Histogram of Inputted Data"},"id":"1002","type":"Title"},{"attributes":{"children":[{"id":"1050","type":"Button"}]},"id":"1056","type":"WidgetBox"},{"attributes":{"axis_label":"number of datapoints","formatter":{"id":"1068","type":"BasicTickFormatter"},"plot":{"id":"1003","subtype":"Figure","type":"Plot"},"ticker":{"id":"1019","type":"BasicTicker"}},"id":"1018","type":"LinearAxis"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"plot":null,"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1031","type":"BoxAnnotation"},{"attributes":{"children":[{"id":"1051","type":"Button"}]},"id":"1057","type":"WidgetBox"},{"attributes":{},"id":"1019","type":"BasicTicker"},{"attributes":{"callback":null},"id":"1005","type":"DataRange1d"},{"attributes":{"callback":null,"data":{"arr_hist":[],"left":[],"right":[]},"selected":{"id":"1072","type":"Selection"},"selection_policy":{"id":"1071","type":"UnionRenderers"}},"id":"1001","type":"ColumnDataSource"},{"attributes":{"children":[{"id":"1052","type":"Button"}]},"id":"1058","type":"WidgetBox"},{"attributes":{"callback":null},"id":"1007","type":"DataRange1d"},{"attributes":{"dimension":1,"plot":{"id":"1003","subtype":"Figure","type":"Plot"},"ticker":{"id":"1019","type":"BasicTicker"}},"id":"1022","type":"Grid"},{"attributes":{"children":[{"id":"1060","type":"WidgetBox"},{"id":"1061","type":"WidgetBox"},{"id":"1062","type":"WidgetBox"}],"sizing_mode":"scale_width"},"id":"1063","type":"Row"},{"attributes":{"children":[{"id":"1053","type":"Button"}]},"id":"1060","type":"WidgetBox"},{"attributes":{"args":{"p":{"id":"1003","subtype":"Figure","type":"Plot"},"src":{"id":"1001","type":"ColumnDataSource"}},"code":"\n    testCallBegin();\n\n    testLog('Initial Plot');\n\n    p.reset.emit();\n\n    var y_data = getData();\n\n    makeDefaultBinCount(y_data);\n\n    var hist_result = getHistBins(y_data);\n    var arr_hist_result = hist_result[0];\n    var left_result = hist_result[1];\n    var right_result = hist_result[2];\n\n    var data = src.data;\n\n    var arr_hist = data['arr_hist'];\n    var left = data['left'];\n    var right = data['right'];\n\n    for (var i = 0; i &lt; arr_hist_result.length; i++){\n        arr_hist[i] = arr_hist_result[i];\n        left[i] = left_result[i];\n        right[i] = right_result[i];\n    }\n\n    src.change.emit();\n\n    testLog([arr_hist.length, left.length, right.length]);\n\n    testCallEnd();\n"},"id":"1043","type":"CustomJS"},{"attributes":{"children":[{"id":"1054","type":"Button"}]},"id":"1061","type":"WidgetBox"},{"attributes":{"children":[{"id":"1055","type":"Button"}]},"id":"1062","type":"WidgetBox"},{"attributes":{"args":{"p":{"id":"1003","subtype":"Figure","type":"Plot"},"src":{"id":"1001","type":"ColumnDataSource"}},"code":"\n    testCallBegin();\n\n    testLog('Plus a bin');\n\n    p.reset.emit();\n\n    var y_data = getData();\n\n    bincount += 1;\n\n    var hist_result = getHistBins(y_data);\n    var arr_hist_result = hist_result[0];\n    var left_result = hist_result[1];\n    var right_result = hist_result[2];\n\n    var data = src.data;\n\n    var arr_hist = data['arr_hist'];\n    var left = data['left'];\n    var right = data['right'];\n\n    for (var i = 0; i &lt; arr_hist_result.length; i++){\n        arr_hist[i] = arr_hist_result[i];\n        left[i] = left_result[i];\n        right[i] = right_result[i];\n    }\n\n    src.change.emit();\n\n    testLog([arr_hist.length, left.length, right.length]);\n\n    testCallEnd();\n"},"id":"1045","type":"CustomJS"},{"attributes":{"children":[{"id":"1059","type":"Row"},{"id":"1063","type":"Row"}],"sizing_mode":"fixed"},"id":"1064","type":"Column"},{"attributes":{"args":{"p":{"id":"1003","subtype":"Figure","type":"Plot"},"src":{"id":"1001","type":"ColumnDataSource"}},"code":"\n    testCallBegin();\n\n    testLog('Minus a bin');\n\n    p.reset.emit();\n\n    var y_data = getData();\n\n    bincount -= 1;\n\n    var hist_result = getHistBins(y_data);\n    var arr_hist_result = hist_result[0];\n    var left_result = hist_result[1];\n    var right_result = hist_result[2];\n\n    var data = src.data;\n\n    var arr_hist = data['arr_hist'];\n    var left = data['left'];\n    var right = data['right'];\n\n    for (var i = 0; i &lt; arr_hist_result.length; i++){\n        arr_hist[i] = arr_hist_result[i];\n        left[i] = left_result[i];\n        right[i] = right_result[i];\n    }\n\n    arr_hist.pop();\n    left.pop();\n    right.pop();\n\n\n    src.change.emit();\n\n    testLog([arr_hist.length, left.length, right.length]);\n\n    testCallEnd();\n"},"id":"1046","type":"CustomJS"},{"attributes":{},"id":"1009","type":"LinearScale"},{"attributes":{"children":[{"id":"1003","subtype":"Figure","type":"Plot"},{"id":"1064","type":"Column"}]},"id":"1065","type":"Row"},{"attributes":{},"id":"1068","type":"BasicTickFormatter"},{"attributes":{"args":{"axis":{"id":"1013","type":"LinearAxis"},"p":{"id":"1003","subtype":"Figure","type":"Plot"},"src":{"id":"1001","type":"ColumnDataSource"}},"code":"\n    testCallBegin();\n\n    testLog('Changing to linear');\n\n    p.reset.emit();\n\n    var y_data = getData();\n\n    var hist_result = getHistBins(y_data);\n    var arr_hist_result = hist_result[0];\n    var left_result = hist_result[1];\n    var right_result = hist_result[2];\n\n    var data = src.data;\n\n    var arr_hist = data['arr_hist'];\n    var left = data['left'];\n    var right = data['right'];\n\n    for (var i = 0; i &lt; arr_hist_result.length; i++){\n        arr_hist[i] = arr_hist_result[i];\n        left[i] = left_result[i];\n        right[i] = right_result[i];\n    }\n\n    axis.axis_label = \"y (data)\";\n\n    p.change.emit()\n\n    src.change.emit();\n\n    testLog([arr_hist.length, left.length, right.length]);\n\n    testCallEnd();\n"},"id":"1047","type":"CustomJS"},{"attributes":{"args":{"axis":{"id":"1013","type":"LinearAxis"},"p":{"id":"1003","subtype":"Figure","type":"Plot"},"src":{"id":"1001","type":"ColumnDataSource"}},"code":"\n    testCallBegin();\n\n    testLog('Changing to logarithmic');\n\n    p.reset.emit();\n\n    var y_data = getData();\n\n    var y_trans = transformLog(y_data);\n\n    var hist_result = getHistBins(y_trans);\n    var arr_hist_result = hist_result[0];\n    var left_result = hist_result[1];\n    var right_result = hist_result[2];\n\n    var data = src.data;\n\n    var arr_hist = data['arr_hist'];\n    var left = data['left'];\n    var right = data['right'];\n\n    for (var i = 0; i &lt; arr_hist_result.length; i++){\n        arr_hist[i] = arr_hist_result[i];\n        left[i] = left_result[i];\n        right[i] = right_result[i];\n    }\n\n    axis.axis_label = \"log(y) (base 10)\";\n\n    p.change.emit();\n\n    src.change.emit();\n\n    testLog([arr_hist.length, left.length, right.length]);\n\n    testCallEnd();\n"},"id":"1048","type":"CustomJS"},{"attributes":{"source":{"id":"1001","type":"ColumnDataSource"}},"id":"1042","type":"CDSView"},{"attributes":{"args":{"axis":{"id":"1013","type":"LinearAxis"},"p":{"id":"1003","subtype":"Figure","type":"Plot"},"src":{"id":"1001","type":"ColumnDataSource"}},"code":"\n    testCallBegin();\n\n    testLog('Changing to exponential');\n\n    p.reset.emit();\n\n    var y_data = getData();\n\n    var y_trans = transformExp(y_data);\n\n    var hist_result = getHistBins(y_trans);\n    var arr_hist_result = hist_result[0];\n    var left_result = hist_result[1];\n    var right_result = hist_result[2];\n\n    var data = src.data;\n\n    var arr_hist = data['arr_hist'];\n    var left = data['left'];\n    var right = data['right'];\n\n    for (var i = 0; i &lt; arr_hist_result.length; i++){\n        arr_hist[i] = arr_hist_result[i];\n        left[i] = left_result[i];\n        right[i] = right_result[i];\n    }\n\n    axis.axis_label = \"10^y\";\n\n    p.change.emit();\n\n    src.change.emit();\n\n    testLog([arr_hist.length, left.length, right.length]);\n\n    testCallEnd();\n"},"id":"1049","type":"CustomJS"}],"root_ids":["1065"]},"title":"Bokeh Application","version":"1.0.4"}}
		        </script>
		        <script type="text/javascript">
		          (function() {
		            var fn = function() {
		              Bokeh.safely(function() {
		                (function(root) {
		                  function embed_document(root) {

		                  var docs_json = document.getElementById('1187').textContent;
		                  var render_items = [{"docid":"efb47904-c92a-4d29-b494-7ca5ba6c5b18","roots":{"1065":"433bc3e3-c3d3-401b-b16a-7eb009a7e174"}}];
		                  root.Bokeh.embed.embed_items(docs_json, render_items);

		                  }
		                  if (root.Bokeh !== undefined) {
		                    embed_document(root);
		                  } else {
		                    var attempts = 0;
		                    var timer = setInterval(function(root) {
		                      if (root.Bokeh !== undefined) {
		                        embed_document(root);
		                        clearInterval(timer);
		                      }
		                      attempts++;
		                      if (attempts > 100) {
		                        console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
		                        clearInterval(timer);
		                      }
		                    }, 10, root)
		                  }
		                })(window);
		              });
		            };
		            if (document.readyState != "loading") fn();
		            else document.addEventListener("DOMContentLoaded", fn);
		          })();
		        </script>
					</div>
			</div>



			<br>
			<br>

			<h1 style="font-size:2.5em; padding-top:25px;"> Select Rejection Method </h1>

			<div id="StepOne" style="overflow:auto">

                <div id="ButtonSection">

                    <h2> Select Uncontaminated Distribution:</h2>

                    <button id="Symmetric" class="Button Distribution"> Gaussian, Mildly Peaked, or Mildly Flat-Topped (Default) </button>
                    <button id="Asymmetric" class="Button Distribution"> Mildly Asymmetric (Less Powerful) </button>
                    <button id="Nongaussian" class="Button Distribution"> Other </button>

                    <h2 id="SelectContaminantSectionTitle"> Select Contaminants:</h2>
		    <div id="SelectContaminantSection">
                    	<button id="Equal" class="Button Contaminants"> High and Low in Equal Proportions </button>
                    	<button id = "OneSided" class="Button Contaminants"> All High or All Low </button>
                    	<button id = "Between" class="Button Contaminants"> In Between (Default) </button>
                    </div>
		</div>
                <div id="RejectionMethod">

                    <h2> Selected Uncontaminated Distribution: </h2>
			<br>
			<img src="{{=URL('static', 'rcr1.png')}}" id="Option1Image">
			<img src="{{=URL('static', 'rcr2.png')}}" id="Option2Image">
			<img src="{{=URL('static', 'rcr3.png')}}" id="Option3Image">
                    <h2> Selected Rejection Method: </h2>
                    <p id="Option11" class="RejectionMethods">
                         &#956: Median (&sect2.1; Maples et al. 2018) <br>
                         &#963 : Broken-line technique (&sect2.2, &sect2.3) <br>
                        Rejection proportional to &#963 both below and above  &#956 (&sect3.1, &sect3.3.2)
                    </p>
                    <p id="Option12" class="RejectionMethods">
                        &#956 : Half-sample mode (&sect2.1; Maples et al. 2018) <br>
                        &#963<sub>-</sub> , &#963<sub>+</sub> : 68.3%-Value technique (&sect2.2, &sect2.3)<br>
                        Rejection proportional to min{&#963<sub>-</sub> , &#963<sub>+</sub>} both below and above &#956 (&sect3.2, &sect3.3.2)
                    </p>
                    <p id="Option13" class="RejectionMethods">
                        &#956: Half-sample mode (&sect2.1; Maples et al. 2018) <br>
                        &#963<sub>-</sub> , &#963<sub>+</sub> : Broken-line technique (&sect2.2, &sect2.3)<br>
                        Rejection proportional to min{&#963<sub>-</sub> , &#963<sub>+</sub>} both below and above &#956 (&sect3.2, &sect3.3.2)
                    </p>
                    <p id="Option2All" class="RejectionMethods">
                        &#956: Half-sample mode (&sect2.1; Maples et al. 2018) <br>
                        &#963<sub>-</sub> , &#963<sub>+</sub> : Broken-line technique (&sect2.2, &sect2.3)<br>
                        Rejection proportional to &#963<sub>-</sub> below &#956 and &#963<sub>+</sub> above &#956 (&sect3.3.1)
                    </p>
                    <p id="Option3" class="RejectionMethods">
			Fundamentally, RCR assumes that the uncontaminated distribution is Gaussian, or near Gaussian.  In particular, our <q>All High or All Low</q> and <q>In Between</q> contaminant type options are especially sensitive to this assumption, and should not be used if this assumption is not met.                    </p>
                    <p id="OptionAll" class="RejectionMethods">
                        Note: Rejection method is iterative, preceded by iterative bulk rejection (&sect5), and followed by both (1) iterative "median + 68.3%-value technique" rejection, and (2) iterative "mean + standard deviation " rejection (&sect4).
                    </p>

                </div>
            </div>


<!--////////////////////////////////////////////////////////////////////////////-->
<!-- DATA INPUT SECTION -->
<!--////////////////////////////////////////////////////////////////////////////-->



            <h1 style="font-size:2.5em; padding-top:25px;"> Output </h1>
            <div id="StepOne">
                <div  id="ButtonSection">
                <br>
                    <div  style="float:left">
                        <button id="PerformRCR" class="Button RejectButton"  onclick="performRCR()">Perform RCR!</button>
                    </div>
                    <div style="padding-left:25%;">
                        <table>
                            <tr>
                                <td>
                                    <h3> Mean: </h3>
                                </td>
                                <td>
                                    <h3 id="outputMean"> 0 </h3>
                                </td>
                            </tr>
                            <tr id="outputStDevRow">
                                <td>
                                    <h3> Standard Deviation: </h3>
                                </td>
                                <td>
                                    <h3 id="outputStDev"> 0 </h3>
                                </td>
                            </tr>
                            <tr id="outputStDevPlusRow">
                                <td>
                                    <h3> Standard Deviation Above Mean: </h3>
                                </td>
                                <td>
                                    <h3 id="outputStDevPlus"> 0 </h3>
                                </td>
                            </tr>
                            <tr id="outputStDevMinusRow">
                                <td>
                                    <h3> Standard Deviation Below Mean: </h3>
                                </td>
                                <td>
                                    <h3 id="outputStDevMinus"> 0 </h3>
                                </td>
                            </tr>


                        </table>
                        <br>

                    </div>
                    <div id="NonRCRNote">
                        <i style="padding-top:10px; display:block;">Note:  RCR not performed.</i>

                    </div>
										<div id="OverRejectionNote">
                        <i id="OverRejectionNotice" style="padding-top:10px; display:block;"></i>

                    </div>
                </div>
		<div id="OutputTableWrapper">
                <div id="RejectionMethod" style="float:right;">
                    <div id="ButtonSection" style="width:100%; padding:5px 0px 5px 0px;">
                    <br>
                        <table style="width:100%;">
                        <tr>
                            <td  style="width:33%;">
                                <button id="showNonRejected" class="Button DataType"> Show Unrejected Points </button>
                            </td>
                            <td  style="width:33%;">
                                <button id="showRejected" class="Button DataType"> Show Rejected Points </button>
                            </td>
                            <td  style="width:33%;">
                                <button id="showAll" class="Button DataType"> Show Both With Flags </button>
                            </td>
                        </tr>
                        </table>
                    </div>
                    <textarea class="dataTable" id="nonRejectedData" style="margin-top:25px;"></textarea>
                    <textarea class="dataTable" id="rejectedData" style="margin-top:25px;"></textarea>
                    <textarea class="dataTable" id="allData" style="margin-top:25px;"></textarea>

		</div>
                </div>

            </div>
		</div>

        <br>
<!--////////////////////////////////////////////////////////////////////////////-->
<!-- DATA OUTPUT SECTION -->
<!--////////////////////////////////////////////////////////////////////////////-->


	</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<!--<script src="jquery.csv.min.js"></script>-->
<!--<script type="text/javascript" src="javascript.js"></script>-->
</html>
<script>
var bincount = 1;

function testCallBegin(){
	console.log('Callback begins');
	return;
}
function testCallEnd(){
	console.log('Callback ends');
	return;
}
function testLog(thing){
	console.log(thing);
	return;
}
function transformExp(data){
	var y_trans = [];

	for (var i = 0; i < data.length; i++){
		y_trans.push(Math.pow(10,data[i]));
	}

	return y_trans;
}
function transformLog(data){
	var y_trans = [];

	for (var i = 0; i < data.length; i++){
		if (data[i] > 0){
			y_trans.push(Math.log10(data[i]));
		}
	}

	return y_trans;
}
function getData(){
	var has_Weights = $('#Weighted').data('clicked');
	var has_ErrorBars = $('#ErrorBars').data('clicked');

	var y_data = [];

	var inputData = document.getElementById('inputTextAreaData').value;

	var inputData_Arr = inputData.split("\n");

	var N = inputData_Arr.length;

    //console.log(inputData_Arr);
	if (has_Weights || has_ErrorBars){
    for (var i = 0; i < N; i++){
    	datapoint = inputData_Arr[i].split("\t");
    	if (datapoint.length < 2){ //if not tab seperated, try space seperated
    		datapoint = inputData_Arr[i].split(" ");
    	}
        y_data.push(Number(datapoint[0]));
		}
	} else {
		for (var i = 0; i < N; i++){
    	datapoint = inputData_Arr[i]
      y_data.push(Number(datapoint));
		}
	}
	//console.log(y_data);
	return y_data;
}
function makeDefaultBinCount(data){
	var N = data.length;
	bincount = Math.round(Math.sqrt(N));
	return;
}
function getHistBins(data){
    //console.log(bincount);
	var arr_hist = []; //each element in this is the number of data points in the associated bin
	var bins = [];
	var binwidth = Math.abs(Math.min(... data) - Math.max(... data)) / bincount
    //console.log(data);
	var edges = [Math.min(... data)];

	for (var i = 0; i < bincount; i++){
    //console.log(edges);
		edges.push(edges[i] + binwidth);

	}
	var left = edges.slice(0, -1);
	var right = edges.slice(1);

	var bintemp = [];

	for (var i = 0; i < bincount; i++){
		bintemp = [];
		for (var j = 0; j < data.length; j++){
			if ((data[j] >= edges[i]) && (data[j] <= edges[i+1])){
				bintemp.push(data[j]); //adds data to the bin if it is between the bounds of the bin
			}
		}
		bins.push(bintemp) //adds an array of data for that bin to bins, the 2D array.
	}

	for (var i = 0; i < bincount; i++){
		arr_hist.push(bins[i].length);
	}
	//console.log(arr_hist);
	//console.log(left);
	//console.log(right);

	return [arr_hist, left, right];
}
function overRejPercentage(N){
 		//N is data size/ number of data points
		var percentageArray = [46.435,65.717,65.717,0.127,
													25.547,48.491,48.491,0.039,
													25.442,29.97,32.381,0.014,
													14.362,20.828,24.589,0.007,
													10.112,14.305,19.601,0.002,
													7.554,9.961,15.853,0.003,
													5.941,7.138,13.151,0.003,
													4.155,5.06,10.952,0,
													3.576,3.702,9.448,0,
													2.694,2.665,7.915,0,
													2.199,2.063,6.912,0,
													1.736,1.506,5.813,0,
													1.405,1.17,5.061,0,
													1.161,0.945,4.377,0,
													1.039,0.719,3.802,0,
													0.867,0.53,3.282,0,
													0.726,0.468,2.961,0,
													0.657,0.346,2.573,0,
													0.597,0.304,2.326,0,
													0.495,0.239,2.037,0,
													0.416,0.183,1.856,0,
													0.365,0.168,1.642,0,
													0.289,0.126,1.51,0,
													0.277,0.109,1.347,0,
													0.256,0.091,1.22,0,
													0.251,0.075,1.149,0,
													0.21,0.056,1.023,0,
													0.209,0.044,0.918,0,
													0.189,0.043,0.874,0,
													0.178,0.033,0.811,0,
													0.17,0.024,0.722,0,
													0.153,0.024,0.649,0,
													0.132,0.014,0.592,0,
													0.113,0.021,0.566,0,
													0.1,0.018,0.537,0,
													0.09,0.014,0.479,0,
													0.083,0.021,0.451,0,
													0.075,0.013,0.418,0,
													0.074,0.013,0.418,0,
													0.067,0.007,0.375,0,
													0.054,0.009,0.365,0,
													0.047,0.006,0.323,0,
													0.045,0.004,0.314,0,
													0.044,0.004,0.287,0,
													0.045,0.002,0.286,0,
													0.037,0.003,0.251,0,
													0.028,0,0.223,0,
													0.026,0.004,0.221,0,
													0.021,0.003,0.221,0,
													0.025,0.003,0.224,0,
													0.021,0.001,0.201,0,
													0.019,0.001,0.189,0,
													0.016,0.001,0.18,0,
													0.017,0.003,0.176,0,
													0.014,0.003,0.162,0,
													0.014,0.002,0.145,0,
													0.013,0.003,0.137,0,
													0.012,0.004,0.132,0,
													0.008,0.002,0.122,0,
													0.009,0.002,0.105,0,
													0.011,0.001,0.103,0,
													0.01,0.001,0.095,0,
													0.009,0.002,0.086,0,
													0.008,0.003,0.086,0,
													0.011,0.001,0.085,0,
													0.013,0.002,0.088,0,
													0.011,0.001,0.08,0,
													0.007,0.001,0.086,0,
													0.004,0,0.078,0,
													0.005,0,0.075,0,
													0.007,0,0.074,0,
													0.004,0.002,0.06,0,
													0.005,0,0.062,0,
													0.008,0,0.063,0,
													0.008,0.002,0.06,4,0,
													0.008,0.001,0.057,0,
													0.006,0.001,0.062,0,
													0.006,0.001,0.055,0,
													0.008,0,0.053,0,
													0.005,0,0.05,0,
													0.005,0.001,0.048,0,
													0.004,0,0.046,0,
													0.005,0,0.049,0,
													0.005,0,0.045,0,
													0.004,0,0.043,0,
													0.005,0,0.039,0,
													0.004,0,0.036,0,
													0.004,0,0.042,0,
													0.004,0.001,0.042,0,
													0.003,0,0.034,0,
													0.004,0,0.037,0,
													0.004,0,0.035,0,
													0.003,0,0.028,0,
													0.003,0,0.028,0,
													0.002,0,0.029,0,
													0.002,0,0.027,0,
													0.002,0,0.027,0];

		var percentage2DArr = []; //converts the percentage data to a 2d array
  	for (var i = 0; i < 97; i++){
  		percentage2DArr.push(percentageArray.slice(0 + 4*i, 4 + 4*i));
  	}

		var hasSymm = $('#Symmetric').data('clicked');
    var hasEq = $('#Equal').data('clicked');
    var hasOne = $('#OneSided').data('clicked');
    var hasInBet = $('#Between').data('clicked');

		var rej; //rej corresponds to the number of the column of rcr_overrejectionprecentages.csv

		if (hasSymm){
			if (hasEq){
				rej = 0; //'ss_med_dl'
			} else if (hasOne){
				rej = 1;
			} else if (hasInBet){
				rej = 2;
			}
		} else {
			rej = 3;
		}

		var percentage = Math.round( percentage2DArr[N-3][rej] * 10) / 10;
		//rounds to first decimal place
		return percentage;
}

function calculateStDev(inputData)
{
	console.log(inputData);
    var request = $.ajax
        (
            {
                url: '{{=URL(request.application, "calculator", "characterizeData")}}',
                type: "POST",
                data: { inputData : inputDataContents,
                      },
                dataType: "json",
                success: function(data, textStatus, jqXHR)
                {
                    console.log('yes');
		    console.log(data);

                    outputMean.innerText = data['mu'];
                    outputStDev.innerText = data['stDevTotal'];
                    outputStDevPlus.innerText = data['stDevAbove'];
                    outputStDevMinus.innerText = data['stDevBelow'];

                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                    console.log(errorThrown)
                    console.log('noOther');
                    console.log(jqXHR);
                    console.log(textStatus);
                }
            }
        );

}
function performRCR(){


    var inputDataContents = document.getElementById('inputTextAreaData').value;

		var inputDataArr = inputDataContents.split("\n");
		var N = inputDataArr.length;

		if (N < 3){
			document.getElementById("OverRejectionNotice").innerHTML = "Note: Please enter at least three, properly formatted data points.";
		} else if (N >= 3 && N <= 99){
			var perc = overRejPercentage(N);
			if (perc < 0.1){
				document.getElementById("OverRejectionNotice").innerHTML = "Note: Chance of runaway overrejection is <0.1%."
			} else if (perc >= 0.1){
			document.getElementById("OverRejectionNotice").innerHTML = "Note: Chance of runaway overrejection is " + perc.toString() +"%.";
			}
		} else if (N > 99){
			document.getElementById("OverRejectionNotice").innerHTML = "Note: Chance of runaway overrejection is <0.1%.";
		}
		$('#OverRejectionNote').css('display','block');

    if ($('#Nongaussian').data('clicked') === true)
    {
	console.log('other');
	calculateStDev(inputDataContents);
	return;
    }
    $('#OutputTableWrapper').css('display', 'inline');

    hasSymmetricDist = $('#Symmetric').data('clicked');
    hasEqualCont = $('#Equal').data('clicked');
    hasOneSidedCont = $('#OneSided').data('clicked');
    hasInBetweenCont = $('#Between').data('clicked');
    hasWeights = $('#Weighted').data('clicked');
		hasErrorBars = $('#ErrorBars').data('clicked');

		if (hasErrorBars){ //makes the weights = 1/error^2.
			var datapoint;
			var w_new;
			//var new_data = [];
			var newInputData = "";

			for (var i = 0; i < N; i++){
				datapoint = inputDataArr[i].split("\t");
				if (datapoint.length < 2){ //if not tab seperated, try space seperated
					datapoint = inputDataArr[i].split(" ");
				}
				//new_data.push([Number(datapoint[0]), 1.0 / Math.pow(Number(datapoint[1]),2.0) ]);
				w_new = 1.0 / Math.pow(Number(datapoint[1]),2.0)
				newInputData += Number(datapoint[0]).toString() + " " + w_new.toString() + "\n";
			}
			inputDataContents = newInputData;
			console.log(inputDataContents);
		}

	console.log(hasSymmetricDist);
	console.log(hasEqualCont);
	console.log(hasOneSidedCont);
	console.log(hasInBetweenCont);
	console.log(hasWeights);
    var request = $.ajax
        (
            {
                url: '{{=URL(request.application, "calculator", "callRCR")}}',
                type: "POST",
                data: { inputData : inputDataContents,
                        symDist : hasSymmetricDist,
                        equalCont :  hasEqualCont,
                        oneSidedCont : hasOneSidedCont,
                        inBetweenCont : hasInBetweenCont,
                        weighted :  hasWeights
                      },
                dataType: "json",
                success: function(data, textStatus, jqXHR)
                {
                    console.log('yes');
		    console.log(data);
                    document.getElementById('nonRejectedData').value = data['nonRejectedData'];
                    document.getElementById('rejectedData').value = data['rejectedData'];
                    document.getElementById('allData').value = data['allData'];

                    outputMean.innerText = data['mu'];

                    outputStDev.innerText = data['stDevTotal'];
                    outputStDevPlus.innerText = data['stDevAbove'];
                    outputStDevMinus.innerText = data['stDevBelow'];

                    console.log(data['rejTech']);


                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                    console.log(errorThrown)
                    console.log('no');
                    console.log(jqXHR);
                    console.log(textStatus);
                }
            }
        );

};

function type(){
        document.getElementById('outputStDevRow').style.display = 'table-row';
        document.getElementById('outputStDevPlusRow').style.display = 'table-row';
        document.getElementById('outputStDevMinusRow').style.display = 'table-row';
        $('#RCRNote').css('display','block');
        $('#NonRCRNote').css('display','none');
				$('#OverRejectionNote').css('display','none');
        $('#SelectContaminantSection').css('display','block');
        $('#OutputTableWrapper').css('display','inline');
	$('#Option1Image').css('display', 'none');
	$('#Option2Image').css('display', 'none');
	$('#Option3Image').css('display', 'none');
	document.getElementById("SelectContaminantSectionTitle").innerHTML = "Select Contaminants:";
	document.getElementById("PerformRCR").innerHTML = "Perform RCR!";
        outputMean.innerText = '';
        outputStDev.innerText = '';
        outputStDevPlus.innerText = '';
        outputStDevMinus.innerText = '';
        $('#OutputTableWrapper').css('display','none');
        document.getElementById('nonRejectedData').value = '';
        document.getElementById('rejectedData').value = '';
        document.getElementById('allData').value = '';
        switch (true)
		{
            case ($('#Symmetric').data('clicked') && $('#Equal').data('clicked')):
				$('.RejectionMethods').css('display','none')
				$('#Option11').css('display','block');
				$('#OptionAll').css('display','block');
				$('#Option1Image').css('display', 'block');
                break;
			case ($('#Symmetric').data('clicked') &&  $('#OneSided').data('clicked')):
				$('.RejectionMethods').css('display','none')
				$('#Option12').css('display','block');
				$('#OptionAll').css('display','block');
				$('#Option1Image').css('display', 'block');
                break;
			case ($('#Symmetric').data('clicked') && $('#Between').data('clicked')):
				$('.RejectionMethods').css('display','none')
				$('#Option13').css('display','block');
				$('#OptionAll').css('display','block');
				$('#Option1Image').css('display', 'block');
                break;
			case ($('#Asymmetric').data('clicked')):
				$('.RejectionMethods').css('display','none')
				$('#Option2All').css('display','block');
				$('#OptionAll').css('display','block');
				$('#Option2Image').css('display', 'block');
                break;
			case ($('#Nongaussian').data('clicked')):
				$('.RejectionMethods').css('display','none')
				$('#Option3').css('display','block');
				$('#Option3Image').css('display', 'block');

                $('#RCRNote').css('display','none');
                $('#SelectContaminantSection').css('display','none');
        	$('#OutputTableWrapper').css('display','none');

		document.getElementById("SelectContaminantSectionTitle").innerHTML = "We do not perform outlier rejection in this case.";
		document.getElementById("PerformRCR").innerHTML = "Characterize!";

                $('#NonRCRNote').css('display','block');

                break;
			default:
				$('.RejectionMethods').css('display','none')

        };
};

function outputSelection(){
       switch (true)
		{
            case ($('#showNonRejected').data('clicked')):
				$('#nonRejectedData').css('display','inline')
				$('#rejectedData').css('display','none');
				$('#allData').css('display','none');
                break;
            case ($('#showRejected').data('clicked')):
				$('#nonRejectedData').css('display','none')
				$('#rejectedData').css('display','inline');
				$('#allData').css('display','none');
                break;
            case ($('#showAll').data('clicked')):
				$('#nonRejectedData').css('display','none')
				$('#rejectedData').css('display','none');
				$('#allData').css('display','inline');
                break;
			default:
				$('.RejectionMethods').css('display','none')

        };
}

function toggleBool(button)	{
		if ($(button).data('clicked') === false)
		{
			$(button).data('clicked',true);
			return;
		}
		else if ($(button).data('clicked') === true)
		{
			$(button).data('clicked', false);
		}
	};

function SingleActiveButtonCheck(button1, button2){
	if ($(button1).data('clicked') === true && $(button2).data('clicked') === true)
	{
		toggleBool($(button2))
		$(button2).toggleClass('ButtonActive');
	}
};

function main(){

	$('#Symmetric').data('clicked',true);
	$('#Asymmetric').data('clicked',false);
	$('#Nongaussian').data('clicked',false);

	$('#Equal').data('clicked',false);
	$('#Between').data('clicked',true);
	$('#OneSided').data('clicked',false);

	$('#Unweighted').data('clicked', true);
	$('#Weighted').data('clicked',false);
	$('#ErrorBars').data('clicked',false);

    $('#showNonRejected').data('clicked',true);
	$('#showRejected').data('clicked',false);
	$('#showAll').data('clicked',false);

	$('#showNonRejected').toggleClass('ButtonActive');
	$('#Symmetric').toggleClass('ButtonActive');
	$('#Between').toggleClass('ButtonActive');
	$('#Unweighted').toggleClass("ButtonActive");



	type();
    outputSelection();

    $('#Symmetric').click(function() {
        if ($('#Symmetric').data('clicked') === false)
        {
            toggleBool('#Symmetric');
            $('#Symmetric').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#Symmetric','#Asymmetric');
            SingleActiveButtonCheck('#Symmetric','#Nongaussian');
            type();
        }
	});
    $('#Asymmetric').click(function() {
        if ($('#Asymmetric').data('clicked') === false)
        {
            toggleBool('#Asymmetric');
            $('#Asymmetric').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#Asymmetric','#Symmetric');
            SingleActiveButtonCheck('#Asymmetric','#Nongaussian');
            type();
        }
    });
    $('#Nongaussian').click(function() {
        if ($('#Nongaussian').data('clicked') === false)
        {
            toggleBool('#Nongaussian');
            $('#Nongaussian').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#Nongaussian','#Symmetric');
            SingleActiveButtonCheck('#Nongaussian','#Asymmetric');
            type();
        }
    });
    $('#Equal').click(function() {
        if ($('#Equal').data('clicked') === false)
        {
            toggleBool('#Equal');
            $('#Equal').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#Equal','#OneSided');
            SingleActiveButtonCheck('#Equal','#Between');
            type();
        }
    });
    $('#OneSided').click(function() {
        if ($('#OneSided').data('clicked') === false)
        {
            toggleBool('#OneSided');
            $('#OneSided').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#OneSided','#Between');
            SingleActiveButtonCheck('#OneSided','#Equal');
            type();
        }
    });
    $('#Between').click(function() {
        if ($('#Between').data('clicked') === false)
        {
            toggleBool('#Between');
            $('#Between').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#Between','#Equal');
            SingleActiveButtonCheck('#Between','#OneSided');
            type();
        }
    });

    $('#showNonRejected').click(function() {
        if ($('#showNonRejected').data('clicked') === false)
        {
            toggleBool('#showNonRejected');
            $('#showNonRejected').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#showNonRejected','#showRejected');
            SingleActiveButtonCheck('#showNonRejected','#showAll');
            outputSelection();
        }
    });

    $('#showRejected').click(function() {
        if ($('#showRejected').data('clicked') === false)
        {
            toggleBool('#showRejected');
            $('#showRejected').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#showRejected','#showNonRejected');
            SingleActiveButtonCheck('#showRejected','#showAll');
            outputSelection();
        }
    });

    $('#showAll').click(function() {
        if ($('#showAll').data('clicked') === false)
        {
            toggleBool('#showAll');
            $('#showAll').toggleClass('ButtonActive');
            SingleActiveButtonCheck('#showAll','#showNonRejected');
            SingleActiveButtonCheck('#showAll','#showRejected');
            outputSelection();
        }
    });

	$('#Unweighted').click(function()	{
        if ($('#Unweighted').data('clicked') === false)
        {
            $('#Unweighted').toggleClass("ButtonActive");
            toggleBool('#Unweighted');
            SingleActiveButtonCheck('#Unweighted','#Weighted');
						SingleActiveButtonCheck('#Unweighted','#ErrorBars');
        }
	});
	$('#Weighted').click(function()	{
        if ($('#Weighted').data('clicked') === false)
        {
            $('#Weighted').toggleClass("ButtonActive");
            toggleBool('#Weighted');
            SingleActiveButtonCheck('#Weighted','#Unweighted');
						SingleActiveButtonCheck('#Weighted','#ErrorBars');
        }
	});
	$('#ErrorBars').click(function()	{
        if ($('#ErrorBars').data('clicked') === false)
        {
            $('#ErrorBars').toggleClass("ButtonActive");
            toggleBool('#ErrorBars');
            SingleActiveButtonCheck('#ErrorBars','#Unweighted');
						SingleActiveButtonCheck('#ErrorBars','#Weighted');
        }
	});

	var oldVal = "";
    $("#inputTextAreaData").on("change keyup paste", function()
    {
        var currentVal = $(this).val();
        if(currentVal == oldVal)
        {
            return; //check to prevent multiple simultaneous triggers
        }

        oldVal = currentVal;
        //action to be performed on textarea changed
        type();
    });

};

$(document).ready(main);
</script>
